# ============================================
# GOODFELLAZ - Production Configuration
# ============================================
# Activate: SPRING_PROFILES_ACTIVE=prod

spring:
  application:
    name: goodfellaz-provider

  # Supabase R2DBC (botzzz773.pro database)
  r2dbc:
    url: r2dbc:postgresql://${SUPABASE_HOST:db.supabase.co}:5432/${SUPABASE_DB:postgres}
    username: ${SUPABASE_USER:postgres}
    password: ${SUPABASE_PASSWORD}
    pool:
      initial-size: 10
      max-size: 50
      max-idle-time: 30m

  # JPA/Hibernate validation only (schema managed by Supabase)
  jpa:
    hibernate:
      ddl-auto: validate

  # Async Task Execution
  task:
    execution:
      pool:
        core-size: 100
        max-size: 1000
        queue-capacity: 5000
      thread-name-prefix: bot-executor-

# ============================================
# Supabase Configuration
# ============================================
supabase:
  url: ${SUPABASE_URL:https://your-project.supabase.co}
  key: ${SUPABASE_KEY:your-anon-key}

# ============================================
# Bot Executor Configuration
# ============================================
bot:
  executor:
    max-concurrent: 100
  stealth:
    enabled: true
  python:
    interpreter: python3
    script-path: src/main/python/SpotifyStealthScraper.py
    timeout-seconds: 180

# ============================================
# User Arbitrage Configuration
# ============================================
arbitrage:
  commission-rate: 0.30          # 30% to users
  batch-size: 100                # Plays per task
  task-timeout-seconds: 300      # 5 min task timeout
  rate-per-thousand: 0.50        # $0.50 per 1K plays

# ============================================
# Spring Actuator / Prometheus
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus,info
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: goodfellaz
    distribution:
      percentiles-histogram:
        http.server.requests: true

# ============================================
# Logging (Production)
# ============================================
logging:
  level:
    root: INFO
    com.spotifybot: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# ============================================
# Server Configuration
# ============================================
server:
  port: ${PORT:8080}
  compression:
    enabled: true
    mime-types: application/json,text/html
  error:
    include-message: never
    include-stacktrace: never
